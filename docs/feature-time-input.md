# Руководство: Работа с временем расхода

## 1. Обзор

В приложении реализована полноценная работа с временем совершения расхода. Время является **необязательным** полем, которое повышает точность учета.

## 2. Ключевые возможности

*   **Автоматическое извлечение**: При импорте из банковских выписок (CSV/HTML) система автоматически распознает и извлекает время из строк формата `ДД.ММ.ГГГГ ЧЧ:ММ`.
*   **Ручной ввод**: Пользователь может вручную добавить или отредактировать время во всех формах создания и редактирования расходов.
*   **Быстрый ввод**: В форме быстрого ввода поле времени автоматически заполняется текущим системным временем для ускорения процесса.
*   **Единый 24-часовой формат**: Во всем приложении используется строгий 24-часовой формат (`ЧЧ:ММ`) без AM/PM, что обеспечивается кастомным UI-компонентом.

## 3. Техническая реализация

### База данных
*   В таблице `expenses` используется поле `expense_time` с типом `TIME`.
*   Поле может быть `NULL`, что обеспечивает обратную совместимость с расходами, у которых время не указано.

### Парсинг и обработка данных
*   **`parseDateAndTime(dateStr)`**: Ключевая функция в `src/lib/utils/bankStatementParsers.ts`, которая принимает строку и возвращает объект `{ date: string; time: string | null }`.
*   Поддерживает различные форматы даты и времени, включая варианты с ведущими нулями и без них.

### Валидация
*   Для всех операций используется схема `Zod` из `src/lib/validations/expenses.ts`.
*   Применяется регулярное выражение `/^\d{2}:\d{2}$/` и дополнительная проверка `refine` для гарантии, что часы находятся в диапазоне `00-23`, а минуты — `00-59`.

### Пользовательский интерфейс: Компонент `TimeInput`
*   **Расположение**: `src/components/ui/TimeInput.tsx`
*   **Назначение**: Заменяет стандартный `<input type="time">` для обеспечения единого и предсказуемого UI во всех браузерах.
*   **Особенности**:
    *   Состоит из двух отдельных полей для часов и минут.
    *   Автоматический переход фокуса между полями при вводе.
    *   Валидация вводимых значений на лету (нельзя ввести час > 23).
    *   Полная поддержка навигации с клавиатуры.
    *   Гарантирует ввод данных строго в 24-часовом формате.
