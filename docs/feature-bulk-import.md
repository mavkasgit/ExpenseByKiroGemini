# Руководство: Массовый ввод и импорт из выписок

## 1. Обзор

Модуль массового ввода представляет собой единый и мощный инструмент для добавления большого количества расходов из различных источников. Он объединяет ручной ввод, вставку из буфера обмена и загрузку файлов в один удобный интерфейс.

## 2. Поддерживаемые источники данных

1.  **Вставка из буфера обмена**: Пользователь может скопировать данные из любой таблицы (Excel, Google Sheets) и вставить их напрямую в текстовое поле.
2.  **Загрузка файлов**: Система поддерживает загрузку файлов различных форматов. Особое внимание уделено банковским выпискам.
    *   **CSV, TXT, XLSX**: Стандартные табличные форматы.
    *   **HTML**: Веб-страницы, сохраненные из интернет-банка.

## 3. Процесс импорта

Процесс импорта состоит из нескольких шагов, которые могут меняться в зависимости от источника данных.

### Шаг 1: Предоставление данных
Пользователь либо вставляет скопированные данные в текстовое поле, либо использует кнопку "Загрузить файл" для выбора файла с диска.

### Шаг 2: Выбор таблицы (только для HTML)
Если загруженный HTML-файл содержит несколько таблиц, система автоматически их обнаружит и предложит пользователю выбрать нужную в модальном окне. Для каждой таблицы будет показан предпросмотр и краткое описание.

### Шаг 3: Сопоставление колонок
После получения данных открывается интерфейс сопоставления колонок. Этот процесс позволяет указать, какие столбцы из исходных данных соответствуют полям расхода в системе (Дата, Сумма, Описание и т.д.).

*Подробное описание этого шага находится в руководстве: **[Сопоставление колонок из банковских выписок](./feature-column-mapping.md)**.*

### Шаг 4: Предпросмотр и создание расходов
После настройки сопоставления пользователь видит финальный предпросмотр и может запустить процесс импорта. Система обработает данные и сообщит о результатах (сколько расходов успешно создано, сколько не удалось).

## 4. Ключевые технологии и улучшения

### Функция "Памяти"
Для максимального удобства система запоминает настройки последнего импорта в `localStorage` браузера:
*   **Выбранная таблица (для HTML)**: При следующей загрузке похожего файла система автоматически выберет правильную таблицу.
*   **Сопоставление колонок**: Конфигурация сопоставления также сохраняется и применяется автоматически, если структура нового файла совпадает с предыдущей.

### Оптимизация производительности
Процесс создания большого количества расходов был значительно ускорен. Вместо того чтобы обрабатывать каждый расход по отдельности (что приводило к N+1 запросам к базе данных), система использует оптимизированный подход:
1.  Все необходимые для категоризации данные (ключевые слова) загружаются **одним запросом**.
2.  Расходы обрабатываются и категоризируются в памяти.
3.  Все подготовленные расходы добавляются в базу данных **одним массовым запросом** (`bulk insert`).

Это сократило время обработки сотен расходов с десятков секунд до нескольких, минимизируя нагрузку на базу данных и улучшая пользовательский опыт.
