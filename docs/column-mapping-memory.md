# Память схемы расположения столбцов

## Описание функциональности

Добавлена возможность запоминания последней использованной схемы расположения столбцов для автоматического применения при следующих массовых вводах.

### Как это работает:

1. **Первое использование**: пользователь настраивает схему столбцов в модальном окне
2. **Сохранение**: схема автоматически сохраняется в localStorage
3. **Повторное использование**: при следующей вставке данных схема применяется автоматически
4. **Условия применения**: количество столбцов должно совпадать с сохраненной схемой

## Техническая реализация

### Новые функции:
```typescript
// Загрузка сохраненной схемы
const loadSavedColumnMapping = useCallback(() => {
  try {
    const saved = localStorage.getItem('bulkExpenseColumnMapping')
    if (saved) {
      const mapping = JSON.parse(saved)
      setSavedColumnMapping(mapping)
      return mapping
    }
  } catch (error) {
    console.warn('Ошибка загрузки сохраненной схемы столбцов:', error)
  }
  return null
}, [])

// Сохранение схемы
const saveColumnMapping = useCallback((mapping: any[]) => {
  try {
    localStorage.setItem('bulkExpenseColumnMapping', JSON.stringify(mapping))
    setSavedColumnMapping(mapping)
  } catch (error) {
    console.warn('Ошибка сохранения схемы столбцов:', error)
  }
}, [])
```

### Автоматическое применение в handlePaste:
```typescript
// Проверяем, есть ли сохраненная схема столбцов
const savedMapping = loadSavedColumnMapping()

if (savedMapping && savedMapping.length === parsedData[0].length) {
  // Автоматически применяем сохраненную схему
  // ... логика обработки данных
  showToast(`Автоматически обработано ${newExpenses.length} записей с сохраненной схемой столбцов`, 'success')
} else {
  // Показываем модальное окно настройки
  setPastedData(parsedData)
  setIsColumnMappingOpen(true)
}
```

### Сохранение в handleColumnMappingApply:
```typescript
const handleColumnMappingApply = useCallback((mapping: any[]) => {
  try {
    // Сохраняем схему столбцов для будущего использования
    saveColumnMapping(mapping)
    
    // ... остальная логика обработки
  }
}, [pastedData, showToast, saveColumnMapping])
```

## Пользовательский опыт

### Первое использование:
1. Пользователь вставляет данные
2. Открывается модальное окно настройки столбцов
3. Пользователь настраивает соответствие полей
4. Схема автоматически сохраняется

### Повторное использование:
1. Пользователь вставляет данные с тем же количеством столбцов
2. **Автоматически применяется сохраненная схема**
3. Данные обрабатываются без показа модального окна
4. Показывается уведомление об автоматической обработке

### Изменение схемы:
- Если количество столбцов отличается - показывается модальное окно
- Новая схема перезаписывает старую
- Всегда сохраняется последняя использованная схема

## Преимущества

1. **Экономия времени**: не нужно каждый раз настраивать столбцы
2. **Удобство**: автоматическая обработка знакомых форматов данных
3. **Гибкость**: возможность изменить схему при необходимости
4. **Надежность**: fallback на ручную настройку при несовпадении
5. **Обратная связь**: уведомления о автоматической обработке

## Хранение данных

- **Место**: localStorage браузера
- **Ключ**: `bulkExpenseColumnMapping`
- **Формат**: JSON массив с настройками столбцов
- **Персистентность**: сохраняется между сессиями
- **Безопасность**: только локальное хранение, не передается на сервер

## Обработка ошибок

- При ошибке загрузки/сохранения - fallback на ручную настройку
- Логирование предупреждений в консоль
- Graceful degradation - функциональность работает и без сохраненной схемы