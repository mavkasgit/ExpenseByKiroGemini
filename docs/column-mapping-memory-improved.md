# Улучшенная память схемы столбцов

## Описание изменений

Обновлена логика работы с сохраненной схемой столбцов - теперь модальное окно всегда показывается, но с предзаполненными настройками из прошлого раза.

### Что изменилось:

1. **Всегда показывается модальное окно**: пользователь может видеть и изменять настройки
2. **Предзаполненные поля**: если есть сохраненная схема - она применяется автоматически
3. **Визуальная индикация**: заголовок показывает что применена сохраненная схема
4. **Полный контроль**: пользователь может изменить любые настройки перед применением

## Пользовательский опыт

### Первое использование:
1. Пользователь вставляет данные
2. Открывается модальное окно с пустыми настройками
3. Пользователь настраивает соответствие полей
4. Схема сохраняется при применении

### Повторное использование:
1. Пользователь вставляет данные
2. **Открывается модальное окно с предзаполненными настройками**
3. Заголовок показывает: "Настройка столбцов (применена сохраненная схема)"
4. Пользователь может:
   - Сразу применить (кнопка "Применить")
   - Изменить любые настройки
   - Сбросить к значениям по умолчанию

## Техническая реализация

### Упрощенная логика в handlePaste:
```typescript
// Если данных больше одного столбца, всегда показываем модальное окно
if (parsedData[0] && parsedData[0].length > 1) {
  setPastedData(parsedData)
  setIsColumnMappingOpen(true)
}
```

### Новый проп в ColumnMappingModal:
```typescript
interface ColumnMappingModalProps {
  // ... существующие пропсы
  savedMapping?: ColumnMapping[] | null // Сохраненная схема столбцов
}
```

### Применение сохраненной схемы в useEffect:
```typescript
// Проверяем, есть ли сохраненная схема и подходит ли она
if (savedMapping && savedMapping.length === columnCount) {
  // Применяем сохраненную схему
  const newFieldAssignments = [/* ... */]
  
  // Восстанавливаем назначения из сохраненной схемы
  savedMapping.forEach((column, index) => {
    column.targetFields.forEach(targetField => {
      const fieldAssignment = newFieldAssignments.find(f => f.field === targetField)
      if (fieldAssignment) {
        fieldAssignment.assignedColumn = index
      }
    })
  })
  
  setFieldAssignments(newFieldAssignments)
}
```

### Визуальная индикация:
```typescript
title={savedMapping && savedMapping.length === columnOrder.length ? 
  "Настройка столбцов (применена сохраненная схема)" : 
  "Настройка столбцов"}
```

## Преимущества нового подхода

1. **Прозрачность**: пользователь всегда видит что происходит
2. **Контроль**: можно изменить настройки перед применением
3. **Удобство**: не нужно заново настраивать, если схема подходит
4. **Гибкость**: легко изменить или сбросить настройки
5. **Обратная связь**: понятно когда применяется сохраненная схема

## Сценарии использования

### Быстрое применение:
1. Вставить данные → модальное окно с готовыми настройками → "Применить"

### Изменение схемы:
1. Вставить данные → модальное окно с готовыми настройками → изменить → "Применить"

### Сброс к умолчанию:
1. Вставить данные → модальное окно с готовыми настройками → "Сбросить" → настроить заново

Теперь пользователь получает лучшее из двух миров: удобство автоматических настроек и полный контроль над процессом!